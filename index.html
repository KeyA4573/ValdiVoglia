<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Impianto idroelettrico Val di Voglia</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
      /* Font Avantgarde */
      @font-face {
        font-family: 'Avantgarde';
        src: url('Avantgarde.woff2') format('woff2'),
             url('Avantgarde.woff') format('woff');
        font-weight: normal;
        font-style: normal;
      }

      body {
        font-family: 'Avantgarde', Arial, sans-serif;
        margin: 0;
        padding-top: 220px;
        background-image: url('PresaVoglia.jpg');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        color: white;
        text-shadow: 1px 1px 2px black;
      }

      /* Titolo principale */
      #titolo {
        position: absolute;
        top: 20px;
        left: 20px;
        font-weight: bold;
        text-decoration: underline;
        font-size: 1.5em;
      }

      /* Informazioni statiche */
      #info {
        position: absolute;
        top: 60px;
        left: 20px;
        text-align: left;
        line-height: 1.6em;
        font-size: 1em;
      }

      /* Sezione dati derivazione */
      #dati-derivazione {
        position: absolute;
        top: 200px;
        left: 20px;
        font-size: 1em; /* stessa dimensione delle info statiche */
        text-align: left;
        line-height: 1.6em;
        background-color: rgba(0,0,0,0.4);
        padding: 10px 15px;
        border-radius: 10px;
      }

      #dati-derivazione h2 {
        font-weight: bold;
        text-decoration: underline;
        margin-bottom: 10px;
        font-size: 1em;
        text-align: left;
      }

      /* Dati dinamici in rosso e allineati a destra */
      #dati-derivazione .dato {
        color: red;
        text-align: right;
        display: inline-block;
        width: 60%; /* occupa il lato destro del blocco */
      }

      /* Responsive */
      @media (max-width: 600px) {
        #titolo { font-size: 1.2em; }
        #info { font-size: 0.9em; }
        #dati-derivazione { font-size: 0.9em; padding: 8px 12px; }
      }

      @media (max-width: 400px) {
        body { padding-top: 180px; }
        #titolo { font-size: 1em; }
        #info { font-size: 0.8em; }
        #dati-derivazione { font-size: 0.8em; padding: 6px 10px; }
      }
    </style>
</head>
<body>
    <!-- Titolo principale -->
    <div id="titolo">Impianto idroelettrico Val di Voglia</div>

    <!-- Informazioni statiche -->
    <div id="info">
        Concessionario: AQA s.r.l.<br>
        Comune: Schilpario (Bg)<br>
        Tipologia d'uso: Idroelettrico<br>
        Portata massima di concessione: 38 l/sec<br>
        Portata media di concessione: 10 l/sec<br>
        Salto nominale: 266,00 m<br>
        Potenza di Concessione: 26,08 kW
    </div>

    <!-- Sezione dati derivazione -->
    <div id="dati-derivazione">
        <h2>Dati Derivazione</h2>
        <div>Stato derivazione: <span id="STATO" class="dato">--</span></div>
        <div>Portata DMV: <span id="DMV" class="dato">--</span></div>
        <div>Aggiornato al <span id="timestamp" class="dato">--</span></div>
    </div>

    <script>
      async function aggiornaDati() {
        try {
          const response = await fetch('dato.json?_=' + Date.now());
          if (!response.ok) {
            console.error('Errore nel fetch:', response.status, response.statusText);
            return;
          }
          const data = await response.json();

          // DMV
          document.getElementById('DMV').innerText = data.DMV;

          // STATO tradotto in testo
          if (data.STATO == 1 || data.STATO === "1") {
            document.getElementById('STATO').innerText = "ATTIVA";
          } else {
            document.getElementById('STATO').innerText = "NON ATTIVA";
          }

          // Timestamp formattato gg/mm/aaaa hh:mm
          const d = new Date(data.timestamp);
          const giorno = String(d.getDate()).padStart(2,'0');
          const mese = String(d.getMonth()+1).padStart(2,'0');
          const anno = d.getFullYear();
          const ore = String(d.getHours()).padStart(2,'0');
          const minuti = String(d.getMinutes()).padStart(2,'0');
          document.getElementById('timestamp').innerText = `${giorno}/${mese}/${anno} ${ore}:${minuti}`;

        } catch (err) {
          console.error('Errore nella richiesta JSON:', err);
        }
      }

      // Primo caricamento
      aggiornaDati();
      // Aggiornamento automatico ogni 30 secondi
      setInterval(aggiornaDati, 30000);
    </script>
</body>
</html>
